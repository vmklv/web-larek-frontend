# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

# Архитектура приложения

Приложение построено по принципу MVP (Model-View-Presenter), который разделяет ответственность между компонентами для повышения тестируемости и гибкости.

- **Model** — управляет данными и взаимодействует с сервером.
- **View** — отвечает за отображение данных и обработку пользовательских событий.
- **Presenter** — служит промежуточным звеном, соединяя модель и представление.


## Основные классы

### Класс `Api`

**Описание**:  
Класс предназначен для работы с сервером через HTTP-запросы. Его задача — предоставление удобных методов для отправки запросов и получения данных.

**Поля**:
- `baseUrl: string` — базовый URL для API, который используется в запросах.
- `options: RequestInit` — параметры для запроса.

**Методы**:
- `get(uri: string)` — выполняет GET-запрос к указанному endpoint и возвращает промис `Promise<object>` с результатом.
- `post(uri: string, data: object, method: ApiPostMethods = 'POST')` — отправляет данные в формате JSON на указанный endpoint, можно указать метод запроса (по умолчанию используется POST).

---

### Класс `EventEmitter`

**Описание**:  
Класс обеспечивает обработку событий в приложении, позволяя генерировать события и подписываться на них.

**Методы**:
- `on (eventName: EventName, callback: (data: T) => void): void` — подписывается на событие с именем `eventName` (строка или регулярное выражение) и вызывает функцию-обработчик `callback` при его возникновении, не возвращая значения.
- `emit(event: string, data?: T): void` — инициализация события.
- `trigger(event: string, context?: Partial<T>): (data: T) => void` — создает и возвращает функцию, которая вызывает событие с именем `event`, опционально принимая часть контекста `context`, и принимает данные события типа `T`, не возвращая значения.

#### Основные события 

- `basket:toOrder` — событие, инициируемое нажатием кнопки «Оформить» в корзине, приводит к отображению модального окна, в котором пользователь может выбрать способ оплаты и указать адрес для доставки товара.

- `basket:open` — событие, инициируемое при нажатии на иконку корзины. Открывает модальное окно с перечнем выбранных товаров и итоговой стоимостью.

- `basket:remove` — событие, инициированное нажатием на иконку корзины внутри интерфейса корзины, приводит к обновлению списка товаров и счётчика на главной странице.

- `add:basket` — событие, инициированное при нажатии на кнопку «В корзину». Приводит к добавлению товара в корзину и перерисовке счётчика корзины на главной.

- `basket:toContacts` — событие, инициируемое при нажатии кнопки «Оформить», приводит к открытию модального окна, в котором требуется заполнение контактных данных.

- `order:cash` — событие, происходящее при выборе метода онлайн-оплаты.

- `orderInput:change` — событие, происходящее при вводе данных в форму заказа (Order) и форму контактов (Contacts), инициирует процесс валидации.

- `order:success` — событие, инициируемое успешным ответом сервера при выполнении оплаты товара, приводит к открытию модального окна, информирующего пользователя об успешном завершении транзакции.

- `contacts:submit` - передачи контактной информации при оформлении заказа.

- `items:changed` — которое инициируется при изменении списка товаров, приводит к обновлению и перерисовке товара на странице.

- `modal:open` - инициируемое при нажатии на карточку товара для открытия предпросмотра.

- `modal:close` — Событие, инициируемое при нажатии кнопки закрытия, клике за пределами модального окна или нажатии клавиши Esc, приводит к закрытию модального окна.

- `card:select` — инициируемое при нажатии на карточку товара, которое получает информацию о конкретном товаре.

- `preview:change` — событие, инициируемое при передаче новых данных модели, уведомляет представление и приводит к обновлению содержимого модального окна.

- `input:error` — событие, осуществляющее валидацию формы и возвращающее список ошибок.


---

### Класс `AppState`

**Описание**:  
Класс представляет собой модель данных всего приложения и включает в себя основные группы данных, а также методы для работы с ними.

**Поля**:
- `items: IProduct[]` — массив объектов товаров приложения.
- `basket: IProduct[]` — массив объектов товаров, добавленных в корзину.
- `preview: string` — превью для карточек.
- `userData: IUser` — данные пользователя.
- `formErrors: FormErrors` — ошибки формы.

**Методы**:
- `getItems(): IProduct[]` — метод для получения списка доступных товаров. 
- `getBasket(): IProduct[]` — возвращает массив товаров в корзине. 
- `getBasketId(): string[]` — возвращает массив идентификаторов товаров в корзине. 
- `getUserData(): IUser` — возвращает данные пользователя. 
- `getProducts(cards: IProduct[]): void` — устанавливает список товаров. 
- `getTotalBasketPrice(): number` — метод для получения общей стоимости товаров в корзине. 
- `getItemById(id: string): IProduct` — возвращает товар по его идентификатору. 
- `getFormErrors(): FormErrors` — возвращает ошибки формы. 
- `getPayment(): string` — возвращает ошибки формы. 
- `setPreview(card: IProduct): void` — устанавливает товар для предпросмотра. 
- `setItems(items: IProduct[]): void` — устанавливает список товаров. 
- `validateContact(): boolean` — метод для проверки корректности контактных данных. 
- `hasProductInBasket(id: string): boolean` — проверяет наличие товара в корзине. 
- `clearOrder(): void` — очищает данные заказа. 
- `clearBasket(): void` — метод для очистки содержимого корзины. 
- `deleteFromBasket(id: string): void` — метод для удаления товара из корзину. 
- `addInBasket(id: string): void` — метод для добавления товара в корзину. 
- `addOrderField(field: keyof IUser, value: string): void` — устанавливает значение для поля данных пользователя и проверяет корректность данных. 
- `clearOrderData(): void` — Очищает данные заказа и ошибки формы. 

---

### Класс `Page`

**Описание**:  
Класс отвечает за отображение контента, видимого пользователю при входе на страницу, включая список карточек товаров, корзину и количество товаров в ней. Он является расширением базового абстрактного класса `Component` и реализует интерфейс `IProductData`.

**Конструктор**:  
```
constructor(container: HTMLElement, events: IEvents)
```

**Поля**:
- `basketCounter: HTMLElement` — содержит разметку счётчика товаров в корзине.
- `gallery: HTMLElement[]` — хранит карточки товаров, отображаемые на странице.
- `wrapper: HTMLElement` — включает общую разметку страницы.
- `basket: HTMLElement` — представляет кнопку для доступа к корзине.

**Методы**:
- `set catalog(items: HTMLElement[]): void` — отвечает за отображение карточек товаров.
- `set locked(value: boolean): void` — устанавливает класс, блокирующий прокрутку страницы.
- `set counter(value: number): void` — обновляет отображение счётчика товаров в корзине.


---

### Класс `Modal`

**Описание**:  
Класс отвечает за управление отображением модального окна. Он наследует от базового абстрактного класса `Component` и предоставляет функциональность для открытия и закрытия модального окна.

**Конструктор**:  
```
constructor(container: HTMLElement, events: IEvents)
```

**Поля**:
- `closeButton: HTMLButtonElement` — элемент разметки кнопки для закрытия модального окна.
- `_content: HTMLElement` — элемент разметки контейнера для размещения содержимого модального окна.

**Методы**:
- `open(): void` — открывает модальное окно.
- `close(): void` — закрывает модальное окно.
- `render(data: IModal): HTMLElement` — отображает содержимое.
- `set content(value: HTMLElement): void` — устанавливает содержимое модального окна.

---

### Класс `Basket`

**Описание**:  
Класс представляет собой реализацию корзины товаров и наследует функциональность базового абстрактного класса `Component`. Он отвечает за отображение содержимого корзины, а также за отображение количества товаров и общей стоимости.

**Конструктор**:  
```
constructor(container: HTMLElement, events: IEvents)
```

**Поля**:
- `productListElement: HTMLElement` — элемент, отвечающий за отображение списка карточек товаров.
- `totalElement: HTMLElement` — элемент, отображающий общую сумму товаров в корзине.
- `basketButton: HTMLElement` — элемент, используемый для отображения стоимости всей корзины.

**Методы**:
- `setList(items: HTMLElement[]): void` — устанавливает товары в разметку.
- `setTotal(value: number): void` — обновляет значение общей суммы товаров.

---

### Класс `Form`

**Описание**:  
Класс отвечает за управление формами в приложении, а также за валидацию введённых данных и отображение ошибок ввода на соответствующей форме. Он является наследником базового абстрактного класса `Component`.

**Конструктор**:  
```
constructor(container: HTMLElement, events: IEvents)
```

**Поля**:
- `submitButton: HTMLButtonElement` — разметка кнопки для отправки формы.
- `errorsElements: HTMLElement` — разметка для отображения ошибок валидации.

**Методы**:
- `changesInForm(field: keyof T, value: string): void` — регистрирует событие, связанное с конкретным полем.
- `set valid(value: boolean): void` — устанавливает состояние валидности формы.
- `set errors(value: string): void` — устанавливает текст ошибки.
- `render(state: Partial<T> & IForm): HTMLFormElement` — отображает форму и её элементы.

---

### Класс `Order`

**Описание**:  
Класс предназначен для отображения выбора метода оплаты и адреса покупателя в модальном окне. Он является расширением класса `Form` и реализует интерфейс `IOrder`.

**Конструктор**:  
```
constructor(container: HTMLElement, events: IEvents)
```

**Поля**:
- `buttonPay: HTMLButtonElement` — разметка кнопок формы оплаты.

**Методы**:
- `set payment(value: string): void` — устанавливает класс активности на кнопку.
- `set address(value: string): void` — устанавливает значение поля адреса.
- `disableButtons(): void` — деактивирует кнопки выбора способа оплаты.
- `clear(): void` — очищает форму заказа.

---

### Класс `Contacts`

**Описание**:  
Класс отвечает за отображение контактов покупателя в модальном окне и расширяет класс `Form` в соответствии с интерфейсом `IOrder`.

**Конструктор**:  
```
constructor(container: HTMLElement, events: IEvents)
```

**Методы**:
- `set phone(value: string): void` — устанавливает значение поля для номера телефона.
- `set email(value: string): void` — устанавливает значение поля для электронной почты.
- `clear(): void` — очищает форму.

---

### Класс `Success`

**Описание**:  
Класс предназначен для отображения информации о успешной покупке. Он является производным от базового абстрактного класса `Component`.

**Конструктор**:  
```
constructor(container: HTMLElement, actions: ISuccessAction)
```

**Поля**:
- `totalAmount: HTMLElement` — хранит информацию о общей сумме товаров в заказе.
- `dismissButton: HTMLButtonElement` — хранит информацию о общей сумме товаров в заказе.

**Методы**:
- `set total(value: string): void` — устанавливает значение общей суммы заказа.

---

### Класс `Card`

**Описание**:  
Класс предназначен для визуализации данных о товаре в модальном окне, корзине и каталоге корзины. Он является расширением интерфейса `IProduct`.

**Конструктор**:  
```
constructor(container: HTMLElement, action?: ICardAction)
```

**Поля**:
- `_title: HTMLElement` — разметка заголовка карточки.
- `_price: HTMLElement` — разметка цены карточки.
- `_button?: HTMLButtonElement` — разметка кнопки.
- `_index?: HTMLButtonElement` — разметка порядкового номера товара в заказе.

**Методы**:
- `set id(value: string): void` — устанавливает идентификатор карточки.
- `set price(value: number): void` — задает стоимость карточки.
- `set title(value: string): void` — задает заголовок карточки.
- `set button(value: string): void` — задает заголовок кнопки.
- `set index(value: number): void` — устанавливает порядковый номер карточки в корзине.

---

### Класс `CardOnPage`

**Описание**:  
Класс наследуется от класса `Card` и представляет собой карточку, которая отображается на странице. Этот класс расширяет функциональность класса `Card`.

**Конструктор**:  
```
constructor(container: HTMLElement, action?: ICardAction)
```

**Поля**:
- `_image: HTMLImageElement` — разметка изображения для карточки.
- `_category: HTMLElement` — разметка категории для карточки.

**Методы**:
- `set image(value: string): void` — устанавливает изображение для карточки.
- `set category(value: CategoryType): void` — устанавливает категорию для карточки.

---

### Класс `CardInfo`

**Описание**:  
Класс отвечает за отображение данных предварительного просмотра карточек товаров и расширяет класс `CardOnPage`.

**Конструктор**:  
```
constructor(container: HTMLElement, action?: ICardAction)
```

**Поля**:
- `_description: HTMLElement` — описание карточки.

**Методы**:
- `set description(value: string): void` — устанавливает описание карточки.

---

### Класс `ApiService`

**Описание**:  
Класс `ApiService` предназначен для взаимодействия с `API`. Он наследуется от класса `Api` и предоставляет методы для получения списка продуктов, отправки заказов и обработки ошибок. Также добавляет CDN-путь к URL изображений продуктов.

**Конструктор**:  
```
constructor(baseUrl: string, cdn: string, options: RequestInit = {})
```

**Поля**:
- `readonly cdn: string` — URL CDN для преобразования путей изображений.

**Методы**:
- `getProducts(): Promise<IProduct[]>` — получает список продуктов с сервера.
- `postOrder(order: IOrderResponse): Promise<IOrderResponse>` — отправляет заказ на сервер.
- `private transformProductImages(items: IProduct[]): IProduct[]>` — преобразует URL изображений продуктов, добавляя CDN.
- `private handleError(err: Error, context: string): never` — обрабатывает ошибки, возникающие при запросах.
- `private getData<T>(endpoint: string): Promise<T>` — выполняет GET-запрос к API.
- `private postData<T>(endpoint: string, data: any): Promise<T>` — выполняет POST-запрос к API

---

### Класс `Model`

**Описание**:  
Класс `Model<T>` является абстрактным базовым классом для моделей данных. Он предоставляет функциональность для работы с событиями и обновления данных. Используется для уведомления о изменениях в данных через систему событий (IEvents).

**Конструктор**:  
```
constructor(data: Partial<T>, protected events: IEvents)
```

**Поля**:
- `events: IEvents` — объект для работы с событиями.

**Методы**:
- `emitChanges(event: string, payload?: T): void` — уведомляет о изменениях в модели, вызывая событие.

---

### Класс `Component`

**Описание**:  
Класс `Component<T>` является абстрактным базовым классом для компонентов. Он предоставляет методы для работы с DOM-элементами, такие как управление классами, текстовым содержимым, состоянием блокировки, отображением элементов и изображений. Также включает метод `render` для обновления данных компонента.

**Конструктор**:  
```
constructor(protected readonly container: HTMLElement)
```

**Методы**:
- `toggleClass(element: HTMLElement, className: string, force?: boolean): void` — переключает класс у элемента.
- `setText(element: HTMLElement | null, value: unknown): void` — устанавливает текстовое содержимое элемента.
- `setDisabled(element: HTMLElement, state: boolean): void` — устанавливает состояние блокировки элемента.
- `hideElement(element: HTMLElement): void` — скрывает элемент, устанавливая `display: none`. 
- `showElement(element: HTMLElement): void` — показывает элемент, удаляя свойство `display`. 
- `setImage(element: HTMLImageElement, src: string, alt?: string): void` — устанавливает изображение и альтернативный текст. 
- `render(data: Partial<T>): HTMLElement` — Обновляет данные компонента и возвращает контейнер. 
---