# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

# Архитектура приложения

Приложение построено по принципу MVP (Model-View-Presenter), который разделяет ответственность между компонентами для повышения тестируемости и гибкости.

- **Model** — управляет данными и взаимодействует с сервером.
- **View** — отвечает за отображение данных и обработку пользовательских событий.
- **Presenter** — служит промежуточным звеном, соединяя модель и представление.


## Основные классы

### Класс `Api`

**Описание**:  
Класс предназначен для работы с сервером через HTTP-запросы. Его задача — предоставление удобных методов для отправки запросов и получения данных.

**Поля**:
- `baseUrl: string` — базовый URL для API, который используется в запросах.
- `options: RequestInit` — параметры для запроса.

**Методы**:
- `get(uri: string)` — выполняет GET-запрос к указанному endpoint и возвращает промис `Promise<object>` с результатом.
- `post(uri: string, data: object, method: ApiPostMethods = 'POST')` — отправляет данные в формате JSON на указанный endpoint, можно указать метод запроса (по умолчанию используется POST).

---

### Класс `EventEmitter`

**Описание**:  
Класс обеспечивает обработку событий в приложении, позволяя генерировать события и подписываться на них.

**Методы**:
- `on (eventName: EventName, callback: (data: T) => void): void` — подписывается на событие с именем `eventName` (строка или регулярное выражение) и вызывает функцию-обработчик `callback` при его возникновении, не возвращая значения.
- `emit(event: string, data?: T): void` — инициализация события.
- `trigger(event: string, context?: Partial<T>): (data: T) => void` — создает и возвращает функцию, которая вызывает событие с именем `event`, опционально принимая часть контекста `context`, и принимает данные события типа `T`, не возвращая значения.

#### Основные события 

- `basket:toOrder` — событие, инициируемое нажатием кнопки «Оформить» в корзине, приводит к отображению модального окна, в котором пользователь может выбрать способ оплаты и указать адрес для доставки товара.

- `basket:open` — событие, инициируемое при нажатии на иконку корзины. Открывает модальное окно с перечнем выбранных товаров и итоговой стоимостью.

- `basket:remove` — событие, инициированное нажатием на иконку корзины внутри интерфейса корзины, приводит к обновлению списка товаров и счётчика на главной странице.

- `add:basket` — событие, инициированное при нажатии на кнопку «В корзину». Приводит к добавлению товара в корзину и перерисовке счётчика корзины на главной.

- `basket:toContacts` — событие, инициируемое при нажатии кнопки «Оформить», приводит к открытию модального окна, в котором требуется заполнение контактных данных.

- `order:cash` — событие, происходящее при выборе метода онлайн-оплаты.

- `orderInput:change` — событие, происходящее при вводе данных в форму заказа (Order) и форму контактов (Contacts), инициирует процесс валидации.

- `order:success` — событие, инициируемое успешным ответом сервера при выполнении оплаты товара, приводит к открытию модального окна, информирующего пользователя об успешном завершении транзакции.

- `contacts:submit` - передачи контактной информации при оформлении заказа.

- `items:changed` — которое инициируется при изменении списка товаров, приводит к обновлению и перерисовке товара на странице.

- `modal:open` - инициируемое при нажатии на карточку товара для открытия предпросмотра.

- `modal:close` — Событие, инициируемое при нажатии кнопки закрытия, клике за пределами модального окна или нажатии клавиши Esc, приводит к закрытию модального окна.

- `card:select` — инициируемое при нажатии на карточку товара, которое получает информацию о конкретном товаре.

- `preview:change` — событие, инициируемое при передаче новых данных модели, уведомляет представление и приводит к обновлению содержимого модального окна.

- `input:error` — событие, осуществляющее валидацию формы и возвращающее список ошибок.


---

### Класс `AppState`

**Описание**:  
Класс представляет собой модель данных всего приложения и включает в себя основные группы данных, а также методы для работы с ними.

**Поля**:
- `items: IProduct[]` — массив объектов товаров приложения.
- `basket: IProduct[]` — массив объектов товаров, добавленных в корзину.
- `order: IOrder` — информация о заказе при покупке товара.
- `preview: string` — превью для карточек.
- `userData: IUser` — данные пользователя.
- `formErrors: FormErrors` — ошибки формы.

**Методы**:
- `getItems(): IProduct[]` — метод для получения списка доступных товаров. 
- `getTotalBasket(): IProduct[]` — метод, возвращающий общее количество товаров в корзине. 
- `getTotalBasketPrice(): number` — метод для получения общей стоимости товаров в корзине. 
- `validateContact(): boolean` — метод для проверки корректности контактных данных. 
- `hasProductInBasket(id: string): boolean` — проверяет наличие товара в корзине. 
- `clearOrder(): void` — очищает данные заказа. 
- `clearBasket(): void` — метод для очистки содержимого корзины. 
- `deleteFromBasket(id: string): void` — метод для удаления товара из корзину. 
- `addInBasket(id: string): void` — метод для добавления товара в корзину. 

---

### Класс `Page`

**Описание**:  
Класс отвечает за отображение контента, видимого пользователю при входе на страницу, включая список карточек товаров, корзину и количество товаров в ней. Он является расширением базового абстрактного класса `Component` и реализует интерфейс `IProductData`.

**Конструктор**:  
```
constructor(container: HTMLElement, events: IEvents)
```

**Поля**:
- `basketCounter: HTMLElement` — содержит разметку счётчика товаров в корзине.
- `productOnPage: HTMLElement[]` — хранит карточки товаров, отображаемые на странице.
- `wrapper: HTMLElement` — включает общую разметку страницы.
- `basket: HTMLElement` — представляет кнопку для доступа к корзине.

**Методы**:
- `set catalog(items: HTMLElement[]): void` — отвечает за отображение карточек товаров.
- `set locked(value: boolean): void` — устанавливает класс, блокирующий прокрутку страницы.
- `set counter(value: number): void` — обновляет отображение счётчика товаров в корзине.

---

### Класс `Cards`

**Описание**:  
Класс предназначен для отображения данных карточки товара в различных элементах интерфейса, включая каталог, модальное окно отдельной карточки и каталог корзины.

**Конструктор**:  
```
constructor(container: HTMLElement, events: IEvents)
```

**Поля**:
- `id: string` — идентификатор карточки.
- `description: HTMLElement` — описание карточки.
- `image: HTMLElement` — разметка изображения карточки.
- `title: HTMLElement` — разметка заголовка карточки.
- `category: HTMLElement` — разметка категории карточки.
- `price: HTMLElement` — разметка цены карточки.

**Методы**:
- `set Data(cardData: IProduct)` — заполняет атрибуты элементов карточки данными.

---

### Класс `Modal`

**Описание**:  
Класс отвечает за управление отображением модального окна. Он наследует от базового абстрактного класса `Component` и предоставляет функциональность для открытия и закрытия модального окна.

**Конструктор**:  
```
constructor(container: HTMLElement, events: IEvents)
```

**Поля**:
- `closeButton: HTMLButtonElement` — элемент разметки кнопки для закрытия модального окна.
- `content: HTMLElement` — элемент разметки контейнера для размещения содержимого модального окна.

**Методы**:
- `open(): void` — открывает модальное окно.
- `close(): void` — закрывает модальное окно.
- `render(data: IModal): HTMLElement` — отображает содержимое.

---

### Класс `Basket`

**Описание**:  
Класс представляет собой реализацию корзины товаров и наследует функциональность базового абстрактного класса `Component`. Он отвечает за отображение содержимого корзины, а также за отображение количества товаров и общей стоимости.

**Конструктор**:  
```
constructor(container: HTMLElement, events: IEvents)
```

**Поля**:
- `productListElement` — элемент, отвечающий за отображение списка карточек товаров.
- `totalElement` — элемент, отображающий общую сумму товаров в корзине.
- `button` — элемент, используемый для отображения стоимости всей корзины.

**Методы**:
- `set List(items: HTMLElement[]): void` — устанавливает товары в разметку.
- `set Total(value: number): void` — обновляет значение общей суммы товаров.

---

### Класс `Form`

**Описание**:  
Класс отвечает за управление формами в приложении, а также за валидацию введённых данных и отображение ошибок ввода на соответствующей форме. Он является наследником базового абстрактного класса `Component`.

**Конструктор**:  
```
constructor(container: HTMLElement, events: IEvents)
```

**Поля**:
- `submitButton: HTMLButtonElement` — разметка кнопки для отправки формы.
- `errors: HTMLElement` — разметка для отображения ошибок валидации.

**Методы**:
- `changesInForm(field: keyof T, value: string): void` — регистрирует событие, связанное с конкретным полем.
- `valid(value: boolean): void` — устанавливает состояние валидности формы.
- `render(state: Partial<T> & IForm): HTMLFormElement` — отображает форму и её элементы.

---

### Класс `Order`

**Описание**:  
Класс предназначен для отображения выбора метода оплаты и адреса покупателя в модальном окне. Он является расширением класса `Form` и реализует интерфейс `IOrder`.

**Конструктор**:  
```
constructor(container: HTMLElement, events: IEvents)
```

**Поля**:
- `buttonPay: HTMLButtonElement` — разметка кнопок формы оплаты.

**Методы**:
- `set Payment(value: string): void` — устанавливает класс активности на кнопку.
- `set Address(value: string): void` — устанавливает значение поля адреса.
- `disableButtons(): void` — убирает выделение с кнопок.

---

### Класс `Contacts`

**Описание**:  
Класс отвечает за отображение контактов покупателя в модальном окне и расширяет класс `Form` в соответствии с интерфейсом `IOrder`.

**Конструктор**:  
```
constructor(container: HTMLElement, events: IEvents)
```

**Методы**:
- `set Phone(value: string): void` — устанавливает значение поля для номера телефона.
- `set Email(value: string): void` — устанавливает значение поля для электронной почты.

---

### Класс `Success`

**Описание**:  
Класс предназначен для отображения информации о успешной покупке. Он является производным от базового абстрактного класса `Component`.

**Конструктор**:  
```
constructor(container: HTMLElement, actions: ISuccessAction)
```

**Поля**:
- `totalAmount: HTMLElement` — хранит информацию о общей сумме товаров в заказе.

**Методы**:
- `set Total(value: string): void` — устанавливает значение общей суммы заказа.

---

### Класс `Card`

**Описание**:  
Класс предназначен для визуализации данных о товаре в модальном окне, корзине и каталоге корзины. Он является расширением интерфейса `IProduct`.

**Конструктор**:  
```
constructor(container: HTMLElement, action?: ICardAction)
```

**Поля**:
- `_title: HTMLElement` — разметка заголовка карточки.
- `_price: HTMLElement` — разметка цены карточки.
- `_button?: HTMLButtonElement` — разметка кнопки.
- `_index?: HTMLButtonElement` — разметка порядкового номера товара в заказе.

**Методы**:
- `set id(value: string): void` — устанавливает идентификатор карточки.
- `set price(value: number): void` — задает стоимость карточки.
- `set title(value: string): void` — задает заголовок карточки.
- `set button(value: string): void` — задает заголовок кнопки.
- `set index(value: number): void` — устанавливает порядковый номер карточки в корзине.

---

### Класс `CardOnPage`

**Описание**:  
Класс наследуется от класса `Card` и представляет собой карточку, которая отображается на странице. Этот класс расширяет функциональность класса `Card`.

**Конструктор**:  
```
constructor(container: HTMLElement, action?: ICardAction)
```

**Поля**:
- `_image: HTMLImageElement` — разметка изображения для карточки.
- `_category: HTMLElement` — разметка категории для карточки.

**Методы**:
- `set image(value: string): void` — устанавливает изображение для карточки.
- `set category(value: CategoryType): void` — устанавливает категорию для карточки.

---

### Класс `CardInfo`

**Описание**:  
Класс отвечает за отображение данных предварительного просмотра карточек товаров и расширяет класс `CardOnPage`.

**Конструктор**:  
```
constructor(container: HTMLElement, action?: ICardAction)
```

**Поля**:
- `_description: HTMLElement` — описание карточки.

**Методы**:
- `set description(value: string): void` — устанавливает описание карточки.

---